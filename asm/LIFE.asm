	Processor 6502

COUT = $FFEF

	org $2000

	LDX #$00
	LDA #$A0
INITLOOP:	
	STA $2400,X
	STA $2500,X
	STA $2600,X
	STA $2700,X
	INX 
	BNE INITLOOP

	JSR CLEARHOME
	JSR WAITFORKEY


; display welcome msg -- since X is FF, we're starting at 217F
;WELCOMEMSGLOOP:
	;LDA DATA+7,X
	;JSR COUT
	;INX 
	;CPX #$38
	;BNE WELCOMEMSGLOOP

INITIALPOPULATION:
	LDA $D01E
	STA $FA
	LDA $D01E
	STA $FB

	JSR L213F

	AND #$3F
	ADC #$20
	STA $F9
	
	LDY #$00
L2030:
	JSR L213F
	AND #$03
	CLC 
	ADC #$24
	STA $F1
	LDA $FA
	STA $F0
	LDA #$AA
	STA ($F0),Y
	DEC $F9
	BNE L2030

; Top of Main loop
LIFEGENERATION:
; set our F8 pointer
	LDA #$24
	STA $F9
	LDA #$40
	STA $F8

; set top and bottom borders to - character
	LDX #$27
	LDA #$AD
BORDERLOOP:
	STA $27D8,X
	STA $2440,X
	DEX 
	BPL BORDERLOOP

; display generation
DISPGENERATION:
	LDA ($F8),Y
	JSR COUT
	INC $F8
	BNE DISPGENERATION
	INC $F9
	LDA $F9
	CMP #$28
	BNE DISPGENERATION

; wait a bit
	JSR MOVEHOME

	LDY #$00
	JSR RESETPOINTERS

; copy to "last generation" table
L2074:
	LDA ($F0),Y
	STA ($F2),Y
	INC $F0
	INC $F2
	BNE L2074
	INC $F1
	INC $F3
	LDA $F1
	CMP #$28
	BNE L2074

	JSR CLEARGENERATION

;Evaluate the grid
L208B:
	LDY #$00
	LDA ($F2),Y
	CMP #$AA
	BNE L209D
	LDY #$27
	JSR L2114
	LDY #$01
	JSR L211D
L209D:
	INC $F0
	INC $F2
	BNE L208B
	INC $F1
	INC $F3
	LDA $F1
	CMP #$28
	BNE L208B

	CLC 
	LDX #$27
L20B0:
	LDA $27D8,X
	ADC $2468,X
	STA $2468,X
	LDA $2440,X
	ADC $27B0,X
	STA $27B0,X
	DEX 
	BPL L20B0
	JSR RESETPOINTERS

L20C8:
	LDY #$00
	LDA ($F0),Y
	CMP #$02
	BNE L20D4
	LDA ($F2),Y
	BNE L20DE
L20D4:
	CMP #$03
	BNE L20DC
	LDA #$AA
	BNE L20DE
L20DC:
	LDA #$A0
L20DE:
	STA ($F0),Y
	INC $F0
	INC $F2
	BNE L20C8
	INC $F1
	INC $F3
	LDA $F3
	CMP #$2C
	BNE L20C8

	LDA $D011
	BPL NEXTGENERATION
	LDA $D010
	JMP INITIALPOPULATION

NEXTGENERATION:
	JMP LIFEGENERATION

RESETPOINTERS:
	LDA #$24
	STA $F1
	LDA #$28
	STA $F3
	LDA #$40
	STA $F0
	STA $F2
	RTS 

WAITFORKEY:
	INC $FA
	BNE L2108
	INC $FB
L2108:
	LDA $D011
	BPL WAITFORKEY
	LDA $D010
	JSR COUT
	RTS

L2114:
	JSR L211D
	INY
	CPY #$2A
	BNE L2114
	RTS

L211D:
	CLC
	LDA ($F0),Y
	ADC #$01
	STA ($F0),Y
	STY $F9
	SEC
	LDA $F0
	SBC $F9
	STA $F6
	LDA $F1
	SBC #$00
	STA $F7
	LDY #$00
	LDA ($F6),Y
	CLC 
	ADC #$01
	STA ($F6),Y
	LDY $F9
	RTS 

L213F:
	LDA $FB
	STA $F6
	LDA $FA
	ASL
	ROL $F6
	ASL
	ROL $F6
	CLC 
	ADC $FA
	PHA 
	LDA $F6
	ADC $FB
	STA $FB
	PLA 
	ADC #$11
	STA $FA
	LDA $FB
	ADC #$36
	STA $FB
	RTS

CLEARGENERATION:
	JSR RESETPOINTERS
	LDA #$00
	TAY
L2167:
	STA ($F0),Y
	INC $F0
	BNE L2167
	INC $F1
	LDX $F1
	CPX #$28
	BNE L2167
	JSR RESETPOINTERS
	RTS

CLEARHOME:
  LDA #27
	JSR COUT
	LDA #'[
  JSR COUT
	LDA #'H
	JSR COUT
  LDA #27
	JSR COUT
	LDA #'[
  JSR COUT
	LDA #'J
	JSR COUT
	RTS

MOVEHOME:
  LDA #27
	JSR COUT
	LDA #'[
  JSR COUT
	LDA #'H
	JSR COUT
	LDA #$8D
	JSR COUT
	RTS

DATA:
	HEX A0 A0 A0 A0 A0 A0 A0 8D 8D 8D 8D C3 CF CE D7 C1 D9 A7 D3 A0 C7 C1 CD C5 A0 CF C6 A0 CC C9 C6 C5 8D 8D D0 CC C5 C1 D3 C5 A0 D4 D9 D0 C5 A0 D9 CF D5 D2 A0 C6 D5 CC CC A0 CE C1 CD C5 AE 8D 8D

